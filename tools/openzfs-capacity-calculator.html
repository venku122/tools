<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenZFS Capacity Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --green-dark: #93c47d;
        --green-med: #b6d7a8;
        --green-light: #d9ead3;
        --red-dark: #c27ba0;
        --red-med: #d5a6bd;
        --red-light: #ead1dc;
        --purple-dark: #8e7cc3;
        --purple-med: #b4a7d6;
        --purple-light: #d9d2e9;
        --blue-dark: #6fa8dc;
        --blue-med: #9fc5e8;
        --blue-light: #cfe2f3;
        --orange-dark: #f6b26b;
        --orange-med: #f9cb9c;
        --orange-light: #fce5cd;
        --yellow-dark: #ffd966;
        --yellow-med: #ffe599;
        --yellow-light: #fff2cc;
        --grey-dark: #b7b7b7;
        --grey-med: #d9d9d9;
        --grey-light: #f3f3f3;
        --ink: #1f1c17;
        --muted: #5d564d;
        --accent: #31849b;
        --accent-strong: #1f5060;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "IBM Plex Sans", Helvetica, sans-serif;
        margin: 0;
        color: var(--ink);
        background: #f6f3ed;
      }

      header {
        width: min(1200px, 100% - 32px);
        margin: 32px auto 12px;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
        color: var(--accent-strong);
        font-weight: 600;
        font-size: 0.95rem;
      }

      h1 {
        font-family: "Space Grotesk", "IBM Plex Sans", sans-serif;
        font-size: clamp(2rem, 3vw, 2.8rem);
        margin: 16px 0 8px;
      }

      header p {
        margin: 0;
        color: var(--muted);
        font-size: 1.05rem;
      }

      main {
        width: min(1200px, 100% - 32px);
        margin: 0 auto 32px;
      }

      table {
        margin-right: auto;
        margin-left: auto;
        text-align: center;
        border-collapse: collapse;
      }

      p.sect_labels {
        width: min(400px, 100%);
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        font-size: 25px;
        margin-bottom: 5px;
        margin-top: 25px;
      }

      p.subsect_label {
        width: min(800px, 100%);
        font-style: italic;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        font-size: 17px;
        margin-bottom: 5px;
        margin-top: 5px;
      }

      button {
        width: 150px;
        cursor: pointer;
      }

      button.change_disk_qty {
        width: 50px;
      }

      button#plus_1 {
        margin-left: 10px;
      }

      button#add_vdev {
        width: 220px;
      }

      td#vdev_button {
        text-align: center;
      }

      td#add_disk {
        margin-top: 30px;
      }

      td#add_disk_button {
        vertical-align: top;
        padding-top: 5px;
        width: 200px;
        text-align: right;
      }

      td#tb_gb_button {
        vertical-align: top;
        padding-top: 5px;
        width: 250px;
        text-align: left;
        padding-left: 10px;
      }

      td#reset_button {
        text-align: center;
      }

      button#reset_button {
        width: 220px;
      }

      td#res_label {
        text-align: right;
      }

      td#res_input {
        text-align: left;
        padding-left: 10px;
      }

      td#status {
        font-size: 14px;
        padding-top: 10px;
        height: 100px;
        text-align: center;
        white-space: pre-wrap;
        font-family: "IBM Plex Mono", "Courier New", Courier, monospace;
      }

      td#add_disk_buttons {
        text-align: center;
      }

      .rocker-button {
        width: 30px;
        height: 50px;
        background: #efefef;
        border-radius: 4px;
        color: black;
        position: relative;
        border: 1px solid black;
        overflow: hidden;
        font-size: 8px;
        display: inline-block;
        margin: 0 3px;
        vertical-align: middle;
      }

      .add_disk_vrule {
        width: 1px;
        height: 52px;
        background: black;
        border-radius: 4px;
        position: relative;
        overflow: hidden;
        display: inline-block;
        margin: 0 3px;
        vertical-align: middle;
      }

      .half {
        width: 100%;
        height: 50%;
        position: absolute;
        left: 0;
        text-align: center;
        cursor: pointer;
        transition: background 0.12s, transform 0.08s;
        user-select: none;
        z-index: 0;
      }

      .half.up {
        top: -3px;
      }

      .half.down {
        bottom: -2px;
      }

      .half.up:hover,
      .half.down:hover {
        background: #e5e5e5;
      }

      .half.up:active,
      .half.down:active {
        background: #f6f6f6;
      }

      .arrow {
        display: inline-block;
        font-size: 12px;
        line-height: 1;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }

      .center-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        pointer-events: none;
        z-index: 1;
      }

      th#first_ssd {
        border-style: solid;
        border-width: 3px 2px 2px 2px;
        border-color: #404040 white white white;
      }

      td#first_ssd {
        border-style: solid;
        border-width: 3px 0 0 0;
        border-color: #404040 white white white;
      }

      th#lowest_custom_size {
        border-style: solid;
        border-width: 2px 2px 3px 2px;
        border-color: white white #404040 white;
      }

      td#lowest_custom_size {
        border-style: solid;
        border-width: 0 0 3px 0;
        border-color: white white #404040 white;
      }

      table.debug#details {
        font-family: "IBM Plex Mono", "Courier New", monospace;
      }

      table.debug#details tr:nth-child(1) {
        background-color: var(--grey-dark);
      }

      table.debug#details tr:nth-child(2n + 2) {
        background-color: var(--grey-light);
      }

      table.debug#details tr:nth-child(2n + 3) {
        background-color: var(--grey-med);
      }

      table.debug#details tr td {
        padding-left: 25px;
        padding-right: 25px;
      }

      table.debug#details tr:nth-child(n + 1) td {
        font-size: 15px;
      }

      table.debug#details tr td:nth-child(6) {
        width: 250px;
      }

      table.inputs tr td:nth-child(1) {
        padding-top: 5px;
        width: 275px;
        text-align: right;
      }

      table.inputs tr td:nth-child(2) {
        padding-top: 5px;
        width: 100px;
        text-align: left;
        padding-left: 10px;
      }

      table.inputs tr td:nth-child(3) {
        padding-top: 5px;
        width: 200px;
        text-align: right;
      }

      table.inputs tr td:nth-child(4) {
        padding-top: 5px;
        width: 275px;
        text-align: left;
        padding-left: 10px;
      }

      table.inputs tr td table.shelf_count tr td {
        text-align: center;
        width: 150px;
        font-size: 14px;
      }

      table.inputs tr td table.shelf_count tr td:nth-child(1) {
        text-align: right;
        font-weight: bold;
      }

      table.inputs tr td table.shelf_count tr:nth-child(1) {
        font-weight: bold;
      }

      label {
        font-size: 20px;
        vertical-align: middle;
      }

      label.tooltip {
        font-size: 12px;
        margin: 0 15px;
        color: rgb(121, 184, 206);
        border: 1px solid rgb(121, 184, 206);
        border-radius: 25px;
        padding: 0 3px;
      }

      input[type="text"] {
        width: 75px;
      }

      select {
        width: 75px;
      }

      input.draid_settings {
        width: 35px;
        font-size: 15px;
        font-family: "IBM Plex Mono", "Courier New", monospace;
      }

      label.draid_settings {
        font-size: 20px;
        font-family: "IBM Plex Mono", "Courier New", monospace;
      }

      td#draid_settings {
        text-align: center;
      }

      th {
        padding-top: 5px;
        padding-bottom: 5px;
        border-style: solid;
        border-color: white;
        border-width: 2px;
      }

      td.results tr td {
        padding-top: 3px;
        padding-bottom: 3px;
        border-style: solid;
        border-color: white;
        border-width: 2px;
      }

      td.white {
        background-color: #ffffff;
        width: 100px;
      }

      table.results tr:nth-child(1) th {
        width: 150px;
      }

      table.results tr:nth-child(2) td {
        font-style: italic;
        font-size: 14px;
      }

      table.results {
        margin-bottom: 50px;
      }

      table#common tr:nth-child(odd) td:nth-child(2) {
        background-color: var(--red-light);
      }

      table#common tr:nth-child(even) td:nth-child(2) {
        background-color: var(--red-med);
      }

      table#common tr:nth-child(1) th:nth-child(2) {
        background-color: var(--red-dark);
      }

      table#common tr:nth-child(odd) td:nth-child(n + 3):nth-child(-n + 5) {
        background-color: var(--purple-light);
      }

      table#common tr:nth-child(even) td:nth-child(n + 3):nth-child(-n + 5) {
        background-color: var(--purple-med);
      }

      table#common tr:nth-child(1) th:nth-child(n + 3):nth-child(-n + 5) {
        background-color: var(--purple-dark);
      }

      table#common tr:nth-child(odd) td:nth-child(n + 6) {
        background-color: var(--blue-light);
      }

      table#common tr:nth-child(even) td:nth-child(n + 6) {
        background-color: var(--blue-med);
      }

      table#common tr:nth-child(1) th:nth-child(n + 6) {
        background-color: var(--blue-dark);
      }

      table#stripes tr:nth-child(odd) td:nth-child(2) {
        background-color: var(--green-light);
      }

      table#stripes tr:nth-child(even) td:nth-child(2) {
        background-color: var(--green-med);
      }

      table#stripes tr:nth-child(1) th:nth-child(2) {
        background-color: var(--green-dark);
      }

      table#stripes tr:nth-child(odd) td:nth-child(n + 3) {
        background-color: var(--red-light);
      }

      table#stripes tr:nth-child(even) td:nth-child(n + 3) {
        background-color: var(--red-med);
      }

      table#stripes tr:nth-child(1) th:nth-child(n + 3) {
        background-color: var(--red-dark);
      }

      table#raidz1 tr:nth-child(odd) {
        background-color: var(--purple-light);
      }

      table#raidz1 tr:nth-child(even) {
        background-color: var(--purple-med);
      }

      table#raidz1 tr:nth-child(1) {
        background-color: var(--purple-dark);
      }

      table#raidz2 tr:nth-child(odd) {
        background-color: var(--blue-light);
      }

      table#raidz2 tr:nth-child(even) {
        background-color: var(--blue-med);
      }

      table#raidz2 tr:nth-child(1) {
        background-color: var(--blue-dark);
      }

      table#raidz3 tr:nth-child(odd) {
        background-color: var(--orange-light);
      }

      table#raidz3 tr:nth-child(even) {
        background-color: var(--orange-med);
      }

      table#raidz3 tr:nth-child(1) {
        background-color: var(--orange-dark);
      }

      table#draid tr:nth-child(odd) {
        background-color: var(--yellow-light);
      }

      table#draid tr:nth-child(even) {
        background-color: var(--yellow-med);
      }

      table#draid tr:nth-child(1) {
        background-color: var(--yellow-dark);
      }

      table.results tr:nth-child(2n + 2) th {
        background-color: var(--grey-dark);
      }

      table.results tr:nth-child(2n + 3) th {
        background-color: var(--grey-med);
      }

      .copy-actions {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }

      #copy_status {
        font-size: 0.9rem;
        color: var(--muted);
      }

      footer {
        width: min(1200px, 100% - 32px);
        margin: 32px auto 40px;
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        font-size: 0.9rem;
        color: var(--muted);
      }

      footer a {
        color: var(--accent-strong);
        text-decoration: none;
        font-weight: 600;
      }

      @media (max-width: 1000px) {
        main {
          overflow-x: auto;
        }

        table.results {
          width: max-content;
        }
      }

      @media (max-width: 720px) {
        header,
        main,
        footer {
          width: min(1200px, 100% - 20px);
        }

        header {
          margin-top: 24px;
        }

        table.inputs,
        table.inputs tbody,
        table.inputs tr,
        table.inputs td {
          display: block;
          width: 100%;
        }

        table.inputs tr {
          padding: 10px 0;
          border-bottom: 1px solid rgba(31, 28, 23, 0.1);
        }

        table.inputs tr td {
          text-align: left;
          padding: 4px 0;
        }

        table.inputs tr td:nth-child(1),
        table.inputs tr td:nth-child(2),
        table.inputs tr td:nth-child(3),
        table.inputs tr td:nth-child(4) {
          width: 100%;
          padding-left: 0;
          padding-right: 0;
        }

        table.inputs tr td table.shelf_count,
        table.inputs tr td table.shelf_count tr,
        table.inputs tr td table.shelf_count td {
          display: block;
          width: 100%;
          text-align: left;
        }

        table.inputs tr td table.shelf_count tr td:nth-child(1) {
          text-align: left;
        }

        label {
          font-size: 1rem;
        }

        label.tooltip {
          margin: 0 8px 0 0;
        }

        input[type="text"],
        select,
        button {
          width: 100%;
          max-width: 100%;
          font-size: 1rem;
          padding: 8px 10px;
        }

        input[type="checkbox"],
        input[type="radio"] {
          transform: scale(1.2);
          margin-right: 8px;
        }

        td#add_disk_buttons {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 6px;
        }

        .rocker-button {
          width: 48px;
          height: 64px;
          font-size: 10px;
        }

        .add_disk_vrule {
          display: none;
        }

        td#add_disk_button,
        td#tb_gb_button,
        td#vdev_button,
        td#reset_button {
          text-align: left;
          padding-top: 8px;
        }

        td#status {
          height: auto;
          min-height: 70px;
          text-align: left;
        }

        p.sect_labels {
          font-size: 1.35rem;
        }

        p.subsect_label {
          font-size: 1rem;
        }

        .copy-actions {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        .results {
          overflow-x: auto;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .half {
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <a class="back-link" href="../index.html">Back to tools</a>
      <h1>OpenZFS Capacity Calculator</h1>
      <p>Estimate usable capacity, efficiency, and overhead for OpenZFS pool layouts, including common RAIDZ and dRAID configurations.</p>
    </header>

    <main>
      <table class="inputs">
        <tr>
          <td><label class="tooltip" id="disks">?</label><label for="disks">Total Disks in Pool:</label></td>
          <td><input class="monitor" type="text" id="disks" name="disks" value="24"></td>
          <td><label for="add_disk" id="add_disk">Add Disk (TB):</label></td>
          <td><input type="text" id="add_disk" name="add_disk"></td>
        </tr>
        <tr>
          <td id="add_disk_buttons" colspan="2">
            <div class="rocker-button">
              <div class="half up" id="plus_1"><div class="arrow">+</div></div>
              <div class="center-text">1</div>
              <div class="half down" id="minus_1"><div class="arrow">-</div></div>
            </div>
            <div class="rocker-button">
              <div class="half up" id="plus_10"><div class="arrow">+</div></div>
              <div class="center-text">10</div>
              <div class="half down" id="minus_10"><div class="arrow">-</div></div>
            </div>
            <div class="rocker-button">
              <div class="half up" id="plus_100"><div class="arrow">+</div></div>
              <div class="center-text">100</div>
              <div class="half down" id="minus_100"><div class="arrow">-</div></div>
            </div>
            <div class="add_disk_vrule"></div>
            <div class="rocker-button">
              <div class="half up" id="plus_12"><div class="arrow">+</div></div>
              <div class="center-text">12</div>
              <div class="half down" id="minus_12"><div class="arrow">-</div></div>
            </div>
            <div class="rocker-button">
              <div class="half up" id="plus_24"><div class="arrow">+</div></div>
              <div class="center-text">24</div>
              <div class="half down" id="minus_24"><div class="arrow">-</div></div>
            </div>
            <div class="rocker-button">
              <div class="half up" id="plus_60"><div class="arrow">+</div></div>
              <div class="center-text">60</div>
              <div class="half down" id="minus_60"><div class="arrow">-</div></div>
            </div>
            <div class="rocker-button">
              <div class="half up" id="plus_102"><div class="arrow">+</div></div>
              <div class="center-text">102</div>
              <div class="half down" id="minus_102"><div class="arrow">-</div></div>
            </div>
          </td>
          <td id="add_disk_button"><button type="button" id="add_disk">Add Disk</button></td>
          <td id="tb_gb_button"><button type="button" id="tb_gb">TB/GB</button></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="min_spares">?</label><label for="min_spares">Minimum Spares:</label></td>
          <td><input class="monitor" type="text" id="min_spares" name="min_spares" value="0"></td>
          <td><label for="add_vdev_type" id="add_vdev_type">New vdev Type:</label></td>
          <td>
            <select name="add_vdev_type" id="add_vdev_type">
              <option value="mirror">Mirror</option>
              <option value="z1">RAIDZ1</option>
              <option value="z2">RAIDZ2</option>
              <option value="z3">RAIDZ3</option>
              <option value="draid">dRAID</option>
            </select>
          </td>
        </tr>
        <tr id="new_vdev">
          <td><label class="tooltip" id="use_new_slop">?</label><label for="use_new_slop">OpenZFS 2.0.7 Slop:</label></td>
          <td><input class="monitor" type="checkbox" id="use_new_slop" name="use_new_slop" checked></td>
          <td><label for="add_vdev" id="add_vdev">New Vdev Width:</label></td>
          <td><input type="text" id="add_vdev" name="add_vdev"></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="recordsize">?</label><label for="recordsize">ZFS recordsize value:</label></td>
          <td>
            <select class="monitor" name="recordsize" id="recordsize">
              <option value="4">4 KiB</option>
              <option value="8">8 KiB</option>
              <option value="16">16 KiB</option>
              <option value="32">32 KiB</option>
              <option value="64">64 KiB</option>
              <option value="128" selected>128 KiB</option>
              <option value="256">256 KiB</option>
              <option value="512">512 KiB</option>
              <option value="1024">1 MiB</option>
              <option value="2048">2 MiB</option>
              <option value="4096">4 MiB</option>
              <option value="8192">8 MiB</option>
              <option value="16384">16 MiB</option>
            </select>
          </td>
          <td id="vdev_button" colspan="2"><button type="button" id="add_vdev">Add vdev Layout</button></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="ashift">?</label><label for="ashift">ZFS ashift value:</label></td>
          <td>
            <select class="monitor" name="ashift" id="ashift">
              <option value="9">9</option>
              <option value="12" selected>12</option>
              <option value="13">13</option>
              <option value="14">14</option>
            </select>
          </td>
          <td></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="swap_size">?</label><label for="swap_size">Disk Swap Size:</label></td>
          <td>
            <select class="monitor" name="swap_size" id="swap_size">
              <option value="0" selected>0 GiB</option>
              <option value="2">2 GiB</option>
              <option value="4">4 GiB</option>
              <option value="8">8 GiB</option>
            </select>
          </td>
          <td><label>Table Data:</label></td>
          <td>
            <input class="monitor" type="radio" id="usable_cap_tib" name="table_data" value="usable_cap_tib" checked>
            <label for="usable_cap_tib">Usable Capacity (TiB)</label><label class="tooltip" id="usable_cap_tib">?</label>
          </td>
        </tr>
        <tr>
          <td><label for="decimal_places">Decimal Places:</label></td>
          <td>
            <select class="monitor" name="decimal_places" id="decimal_places">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="bytes">bytes</option>
            </select>
          </td>
          <td></td>
          <td>
            <input class="monitor" type="radio" id="usable_cap_tb" name="table_data" value="usable_cap_tb">
            <label for="usable_cap_tb">Usable Capacity (TB)</label><label class="tooltip" id="usable_cap_tb">?</label>
          </td>
        </tr>
        <tr>
          <td><label class="tooltip" id="show_deflate">?</label><label for="show_deflate">Show Deflate Ratio:</label></td>
          <td><input class="monitor" type="checkbox" id="show_deflate" name="show_deflate"></td>
          <td></td>
          <td>
            <input class="monitor" type="radio" id="efficiency" name="table_data" value="efficiency">
            <label for="efficiency">Capacity Efficiency</label><label class="tooltip" id="efficiency">?</label>
          </td>
        </tr>
        <tr>
          <td><label class="tooltip" id="show_afr">?</label><label for="show_afr">Show Pool AFR:</label></td>
          <td><input class="monitor" type="checkbox" id="show_afr" name="show_afr"></td>
          <td></td>
          <td>
            <input class="monitor" type="radio" id="overhead" name="table_data" value="overhead">
            <label for="overhead">ZFS Overhead</label><label class="tooltip" id="overhead">?</label>
          </td>
        </tr>
        <tr>
          <td><label id="disk_afr_label" for="disk_afr" style="color: grey;">Disk AFR (%):</label></td>
          <td><input class="monitor" type="text" id="disk_afr" name="disk_afr" value="5" disabled></td>
          <td></td>
          <td>
            <input class="monitor" type="radio" id="cap_w_reserve" name="table_data" value="cap_w_reserve">
            <label for="cap_w_reserve">Cap. w/ Reservation</label><label class="tooltip" id="cap_w_reserve">?</label>
          </td>
        </tr>
        <tr>
          <td><label id="allow_resilver_label" for="allow_resilver" style="color: grey;">Allow Resilver:</label></td>
          <td><input class="monitor" type="checkbox" id="allow_resilver" name="allow_resilver" disabled></td>
          <td><label id="resilver_time_label" for="resilver_time" style="color: grey;">Resilver Time (hrs):</label></td>
          <td><input class="monitor" type="text" id="resilver_time" name="resilver_time" value="24" disabled></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="fast_draid">?</label><label for="fast_draid">Fast dRAID Calculation:</label></td>
          <td><input class="monitor" type="checkbox" id="fast_draid" name="fast_draid" checked></td>
          <td id="res_label"><label id="reservation" for="reservation" style="color: grey;">Reservation (%):</label></td>
          <td id="res_input"><input class="monitor" type="text" id="reservation" name="reservation" value="20" disabled></td>
        </tr>
        <tr>
          <td><label class="tooltip" id="show">?</label><label for="show">Show Only:</label></td>
          <td>
            <select class="monitor" name="show" id="show">
              <option value="all" selected>All</option>
              <option value="stripes">Mirrors/Stripes</option>
              <option value="raidz1">RAIDZ1</option>
              <option value="raidz2">RAIDZ2</option>
              <option value="raidz3">RAIDZ3</option>
              <option value="draid">dRAID</option>
            </select>
          </td>
          <td id="reset_button" colspan="2"><button type="button" id="reset_button">Reset</button></td>
        </tr>
        <tr>
          <td id="status" colspan="4"></td>
        </tr>
      </table>

      <div class="copy-actions">
        <button type="button" id="copy_table">Copy visible tables</button>
        <div id="copy_status" role="status" aria-live="polite"></div>
      </div>

      <p class="sect_labels" id="common">Common Layouts</p>
      <div class="results" id="common">
        <table class="results" id="common"></table>
      </div>

      <p class="sect_labels" id="stripes">Raw, Stripes, & Mirrors</p>
      <div class="results" id="stripes">
        <table class="results" id="stripes"></table>
      </div>

      <p class="sect_labels" id="raidz1">RAIDZ1</p>
      <div class="results" id="raidz1">
        <table class="results" id="raidz1"></table>
      </div>

      <p class="sect_labels" id="raidz2">RAIDZ2</p>
      <div class="results" id="raidz2">
        <table class="results" id="raidz2"></table>
      </div>

      <p class="sect_labels" id="raidz3">RAIDZ3</p>
      <div class="results" id="raidz3">
        <table class="results" id="raidz3"></table>
      </div>

      <p class="sect_labels" id="draid">dRAID</p>
      <div class="results" id="draid">
        <table class="results" id="draid"></table>
      </div>

      <p class="sect_labels" id="debug_vals">Calculation Values -</p>
      <div id="debug_vals">
        <p class="subsect_label">(Click table cells above to freeze/unfreeze)</p>
        <table class="debug" id="debug_vals"></table>
      </div>
    </main>

    <footer>
      <a href="#" id="sourceLink">View source</a>
      <a href="#" id="transcriptLink">Transcript</a>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
    <script>
      const REPO = "venku122/tools";
      const BRANCH = "main";
      const fileName = window.location.pathname.split("/").pop();
      const slug = fileName.replace(/\.html$/i, "");
      const sourceLink = document.getElementById("sourceLink");
      const transcriptLink = document.getElementById("transcriptLink");

      if (sourceLink) {
        sourceLink.href = `https://github.com/${REPO}/blob/${BRANCH}/tools/${fileName}`;
      }
      if (transcriptLink) {
        transcriptLink.href = `https://github.com/${REPO}/blob/${BRANCH}/transcripts/${slug}.md`;
      }

      $(document).ready(function() {
        const tb_to_tib = Math.pow(1000, 4) / Math.pow(1024, 4);

        var disks;
        var min_spares;
        var use_new_slop;
        var recordsize;
        var ashift;
        var swap_size;
        var decimal_places;
        var show_bytes;
        var show_afr;
        var disk_afr;
        var show_deflate;
        var table_data;
        var reservation;
        var fast_draid;
        var show;
        var lowest_custom_size;
        var allow_resilver;
        var resilver_time;

        var hdd_sizes = [4, 8, 12, 14, 16, 18, 22, 24, 26];
        var ssd_sizes = [1.92, 3.84, 7.68, 15.36, 30.72, 61.44, 122.88];
        var custom_sizes = [];
        var disk_sizes = hdd_sizes.concat(ssd_sizes);
        var first_ssd = ssd_sizes[0];
        var mirror = [0, 1, 2, 3];
        var z1 = [3, 4, 5, 6, 7, 8, 9, 10];
        var z2 = [5, 6, 7, 8, 9, 10, 11, 12];
        var z3 = [7, 8, 9, 10, 11, 12, 13, 14];
        var draid = [
          "draid1:4d:24c:0s",
          "draid1:8d:24c:0s",
          "draid2:8d:24c:0s",
          "draid2:16d:24c:0s",
          "draid3:8d:24c:0s",
          "draid3:16d:24c:0s"
        ];

        var raid_layouts = ["common", mirror, z1, z2, z3, draid];
        var raid_names = ["c", "Mirror", "Z1", "Z2", "Z3", "dRAID"];
        var raid_labels = ["c", "m", "z1", "z2", "z3", "d"];
        var update_with_mouseover = true;
        var add_disk_unit = "TB";
        var common = ["2wm", "3wz1", "4wz1", "5wz1", "5wz2", "6wz2", "10wz2", "11wz2"];

        $("label#reservation").css("color", "grey");
        $("label#disk_afr_label").css("color", "grey");
        $("label#allow_resilver_label").css("color", "grey");
        $("label#resilver_time_label").css("color", "grey");

        function rnd(num, scale) {
          if (!("" + num).includes("e")) {
            return +(Math.round(num + "e+" + scale) + "e-" + scale);
          }
          var arr = ("" + num).split("e");
          var sig = "";
          if (+arr[1] + scale > 0) {
            sig = "+";
          }
          return +(Math.round(+arr[0] + "e" + sig + (+arr[1] + scale)) + "e-" + scale);
        }

        function validate_input(input, var_name, def, min, max, whole_num) {
          var orig = input;
          if (isNaN(input)) {
            input = def;
          } else {
            if (whole_num) {
              input = Math.round(input);
            }
            if (input < min) {
              input = min;
            }
            if (input > max) {
              input = max;
            }
            if (max < min) {
              input = 0;
            }
          }
          if (orig != input && var_name != "") {
            $("input#" + var_name).val(input);
          }
          return input;
        }

        var params = window.location.href.split("?");
        if (params.length > 1) {
          params = params[1].split("&");
          for (var i = 0; i < params.length; i++) {
            param = params[i].split("=");
            if (param.length > 1) {
              var_name = param[0];
              var_val = param[1];

              if (var_name == "disks") {
                param_disks = validate_input(var_val, "", 24, 0, 999999, true);
                $("input#disks").val(param_disks);
              }

              if (var_name == "swap") {
                param_swap = validate_input(var_val, "", 2, 0, 8, true);
                $("select#swap_size").val(param_swap);
              }
            }
          }
        }

        function draw_tables() {
          get_form_data();

          $("table.results").html("");

          for (var raid_type_index = 0; raid_type_index < raid_layouts.length; raid_type_index++) {
            var raid_name = raid_names[raid_type_index];
            var raid_label = raid_labels[raid_type_index];
            var vdev_widths = raid_layouts[raid_type_index];
            if (vdev_widths == "common") {
              vdev_widths = common;
            }

            var tr_text = ["", "", "", ""];
            for (var width_index = 0; width_index < vdev_widths.length; width_index++) {
              var vdev_width = vdev_widths[width_index];

              if (raid_type_index == 0) {
                layout_temp = vdev_width;
                vdev_width = layout_temp.split("w")[0];
                raid_label = layout_temp.split("w")[1];
                if (raid_label == "m") {
                  raid_name = "Mirror";
                } else {
                  raid_name = raid_label.toUpperCase();
                }
              }

              if (width_index == 0) {
                tr_text[0] += "<tr><td class=\"white\"></td>";
                tr_text[1] += "<tr><td class=\"white\"></td>";

                if (show_afr) {
                  tr_text[2] += "<tr><th>Pool AFR</td>";
                }

                if (show_deflate) {
                  tr_text[3] += "<tr><th>Deflate %</td>";
                }
              }
              if (vdev_width == 0) {
                tr_text[0] += "<th>Raw</th>";
              } else if (vdev_width == 1) {
                tr_text[0] += "<th>Stripe</th>";
              } else if (raid_label == "m") {
                tr_text[0] += "<th>" + vdev_width + "-Way " + raid_name + "</th>";
              } else if (raid_label == "d") {
                tr_text[0] += "<th>" + vdev_width + "</th>";
              } else {
                tr_text[0] += "<th>" + vdev_width + "-Wide " + raid_name + "</th>";
              }

              if (raid_label == "d") {
                var draid_label = vdev_width.replaceAll(":", "-");
                tr_text[1] += "<td class=\"vdev" + draid_label + "\"></td>";
              } else {
                tr_text[1] += "<td class=\"vdev" + vdev_width + "w" + raid_label + "\"></td>";
              }

              if (show_afr) {
                if (raid_label == "d") {
                  tr_text[2] += "<td class=\"vdev" + vdev_width.replaceAll(":", "-") + "afr\"></td>";
                } else {
                  tr_text[2] += "<td class=\"vdev" + vdev_width + "w" + raid_label + "afr\"></td>";
                }
              }

              if (show_deflate) {
                if (raid_label == "d") {
                  tr_text[3] += "<td class=\"vdev" + vdev_width.replaceAll(":", "-") + "deflate\"></td>";
                } else {
                  tr_text[3] += "<td class=\"vdev" + vdev_width + "w" + raid_label + "deflate\"></td>";
                }
              }
            }

            tr_text[0] += "</tr>";
            tr_text[1] += "</tr>";
            tr_text[2] += "</tr>";
            tr_text[3] += "</tr>";

            if (raid_type_index == 0) {
              $("table#common").append(tr_text[0]);
              $("table#common").append(tr_text[1]);
              if (show_afr) {
                $("table#common").append(tr_text[2]);
              }
              if (show_deflate) {
                $("table#common").append(tr_text[3]);
              }
            } else if (raid_type_index == 1) {
              $("table#stripes").append(tr_text[0]);
              $("table#stripes").append(tr_text[1]);
              if (show_afr) {
                $("table#stripes").append(tr_text[2]);
              }
              if (show_deflate) {
                $("table#stripes").append(tr_text[3]);
              }
            } else if (raid_label == "d") {
              $("table#draid").append(tr_text[0]);
              $("table#draid").append(tr_text[1]);
              if (show_afr) {
                $("table#draid").append(tr_text[2]);
              }
              if (show_deflate) {
                $("table#draid").append(tr_text[3]);
              }
            } else {
              $("table#raid" + raid_label).append(tr_text[0]);
              $("table#raid" + raid_label).append(tr_text[1]);
              if (show_afr) {
                $("table#raid" + raid_label).append(tr_text[2]);
              }
              if (show_deflate) {
                $("table#raid" + raid_label).append(tr_text[3]);
              }
            }

            for (var disk_size_index = 0; disk_size_index < disk_sizes.length; disk_size_index++) {
              disk_size = disk_sizes[disk_size_index];

              if (Number.isInteger(disk_size) == true) {
                disk_size_label = disk_size;
              } else {
                disk_size_label = disk_size.toString().replace(".", "_");
              }

              var tr_text = "";

              for (var width_index = 0; width_index < vdev_widths.length; width_index++) {
                var vdev_width = vdev_widths[width_index];

                if (raid_type_index == 0) {
                  layout_temp = vdev_width;
                  vdev_width = layout_temp.split("w")[0];
                  raid_label = layout_temp.split("w")[1];
                  if (raid_label == "m") {
                    raid_name = "Mirror";
                  } else {
                    raid_name = raid_label.toUpperCase();
                  }
                }

                if (width_index == 0) {
                  if (disk_size < 1) {
                    disk_size = disk_size * 1000;
                    if (disk_size == first_ssd) {
                      tr_text += "<tr><th id=\"first_ssd\">" + disk_size + "GB</th>";
                    } else if (disk_size == lowest_custom_size) {
                      tr_text += "<tr><th id=\"lowest_custom_size\">" + disk_size + "GB</th>";
                    } else {
                      tr_text += "<tr><th>" + disk_size + "GB</th>";
                    }
                  } else if (disk_size > 1000) {
                    disk_size = disk_size / 1000;
                    if (disk_size == first_ssd) {
                      tr_text += "<tr><th id=\"first_ssd\">" + disk_size + "PB</th>";
                    } else if (disk_size == lowest_custom_size) {
                      tr_text += "<tr><th id=\"lowest_custom_size\">" + disk_size + "PB</th>";
                    } else {
                      tr_text += "<tr><th>" + disk_size + "PB</th>";
                    }
                  } else {
                    if (disk_size == first_ssd) {
                      tr_text += "<tr><th id=\"first_ssd\">" + disk_size + "TB</th>";
                    } else if (disk_size == lowest_custom_size) {
                      tr_text += "<tr><th id=\"lowest_custom_size\">" + disk_size + "TB</th>";
                    } else {
                      tr_text += "<tr><th>" + disk_size + "TB</th>";
                    }
                  }
                }

                if (raid_label == "d") {
                  var draid_label = vdev_width.replaceAll(":", "-");
                  if (disk_size == first_ssd) {
                    tr_text += "<td id=\"first_ssd\" class=\"" + disk_size_label + "t" + draid_label + "\"></td>";
                  } else if (disk_size == lowest_custom_size) {
                    tr_text += "<td id=\"lowest_custom_size\" class=\"" + disk_size_label + "t" + draid_label + "\"></td>";
                  } else {
                    tr_text += "<td class=\"" + disk_size_label + "t" + draid_label + "\"></td>";
                  }
                } else {
                  if (disk_size == first_ssd) {
                    tr_text += "<td id=\"first_ssd\" class=\"" + disk_size_label + "t" + vdev_width + "w" + raid_label + "\"></td>";
                  } else if (disk_size == lowest_custom_size) {
                    tr_text += "<td id=\"lowest_custom_size\" class=\"" + disk_size_label + "t" + vdev_width + "w" + raid_label + "\"></td>";
                  } else {
                    tr_text += "<td class=\"" + disk_size_label + "t" + vdev_width + "w" + raid_label + "\"></td>";
                  }
                }
              }

              tr_text += "</tr>";
              if (raid_type_index == 0) {
                $("table#common").append(tr_text);
              } else if (raid_type_index == 1) {
                $("table#stripes").append(tr_text);
              } else if (raid_label == "d") {
                $("table#draid").append(tr_text);
              } else {
                $("table#raid" + raid_label).append(tr_text);
              }
            }
          }
        }

        function get_form_data() {
          disks = parseFloat($("input#disks").val());
          min_spares = parseFloat($("input#min_spares").val());
          use_new_slop = $("input#use_new_slop").is(":checked");
          recordsize = parseInt($("select#recordsize").val());
          ashift = parseInt($("select#ashift").val());
          swap_size = parseInt($("select#swap_size").val());
          decimal_places = $("select#decimal_places").val();
          show_deflate = $("input#show_deflate").is(":checked");
          show_afr = $("input#show_afr").is(":checked");
          disk_afr = parseFloat($("input#disk_afr").val());
          allow_resilver = $("input#allow_resilver").is(":checked");
          resilver_time = parseFloat($("input#resilver_time").val());
          table_data = $("input[name='table_data']:checked").val();
          reservation = parseInt($("input#reservation").val());
          fast_draid = $("input#fast_draid").is(":checked");
          show = $("select#show").val();

          disks = validate_input(disks, "disks", 24, 0, 999999, true);
          min_spares = validate_input(min_spares, "min_spares", 0, 0, disks - 1, true);

          if (decimal_places == "bytes") {
            show_bytes = true;
            decimal_places = 10;
          } else {
            show_bytes = false;
            decimal_places = parseInt(decimal_places);
          }

          disk_afr = validate_input(disk_afr, "disk_afr", 1, 0, 100, false);
          disk_afr = disk_afr / 100;

          resilver_time = validate_input(resilver_time, "resilver_time", 24, 0, 8760, false);

          reservation = validate_input(reservation, "reservation", 20, 0, 100, false);
          reservation = reservation / 100;
        }

        function get_capacity(vdev_layout) {
          var cd = {};
          cd.disk_size = vdev_layout.split("t")[0];

          if (cd.disk_size.includes("_")) {
            cd.disk_size = cd.disk_size.replace("_", ".");
            cd.disk_size = parseFloat(cd.disk_size);
          } else {
            cd.disk_size = parseInt(cd.disk_size);
          }

          if (vdev_layout.includes("wz")) {
            cd.vdev_width = parseInt(vdev_layout.split("t")[1].split("wz")[0]);
            cd.parity_level = parseInt(vdev_layout.split("wz")[1]);
            cd.raid_type = "z";
          } else if (vdev_layout.includes("draid")) {
            cd.vdev_width = parseInt(vdev_layout.split(":")[2].replace("c", ""));
            cd.parity_level = parseInt(vdev_layout.split("t")[1].split(":")[0].replace("draid", ""));
            cd.data_disks = parseInt(vdev_layout.split(":")[1].replace("d", ""));
            cd.spare_disks = parseInt(vdev_layout.split(":")[3].replace("s", ""));
            cd.raid_type = "d";

            if (cd.vdev_width > disks || cd.vdev_width < cd.parity_level + cd.data_disks + cd.spare_disks) {
              cd.pool_usable_bytes = 0;
              cd.pool_usable_gib = 0;
              cd.pool_usable_tib = 0;
              cd.pool_usable_pib = 0;
              cd.pool_usable_eib = 0;
              cd.pool_usable_gb = 0;
              cd.pool_usable_tb = 0;
              cd.pool_usable_pb = 0;
              cd.pool_usable_eb = 0;
              cd.vdev_count = 0;
              cd.spares_count = disks;
              return cd;
            }
          } else {
            cd.vdev_width = parseInt(vdev_layout.split("t")[1].split("wm")[0]);
            cd.raid_type = "m";
          }

          if (cd.vdev_width == 0) {
            cd.pool_usable_bytes = 0;
            cd.pool_usable_gib = 0;
            cd.pool_usable_tib = 0;
            cd.pool_usable_pib = 0;
            return cd;
          }

          cd.vdev_count = Math.floor((disks - min_spares) / cd.vdev_width);
          cd.disks_in_pool = cd.vdev_count * cd.vdev_width;
          cd.spares_count = ((disks - min_spares) % cd.vdev_width) + min_spares;
          cd.pool_raw_capacity = cd.disks_in_pool * cd.disk_size * 1000 ** 4;

          cd.zfs_partition_size = (cd.disk_size * 1000 ** 4) - (swap_size * 1024 ** 3);

          cd.vdev_label_size = 256 * 1024;
          cd.boot_block_size = 8 * 2 ** 19;
          cd.zfs_usable_partition_size = cd.zfs_partition_size - 4 * cd.vdev_label_size - cd.boot_block_size;

          cd.zfs_osize = Math.floor(cd.zfs_usable_partition_size / (256 * 1024)) * 256 * 1024;

          if (cd.raid_type == "m") {
            cd.vdev_asize = cd.zfs_osize;
          }
          if (cd.raid_type == "z") {
            cd.vdev_asize = cd.zfs_osize * cd.vdev_width;
          }
          if (cd.raid_type == "d") {
            cd.row_height = 2 ** 24;
            cd.reflow_reserve = 2 ** 25;
            cd.group_width = cd.parity_level + cd.data_disks;
            cd.group_size = cd.group_width * cd.row_height;
            cd.child_asize = Math.floor((cd.zfs_osize - cd.reflow_reserve) / cd.row_height) * cd.row_height;
            cd.vdev_raw_asize = cd.child_asize * (cd.vdev_width - cd.spare_disks);
            cd.vdev_asize = Math.floor(cd.vdev_raw_asize / cd.group_size) * cd.group_size;
          }

          for (var ms_shift_temp = 29; ms_shift_temp <= 34; ms_shift_temp++) {
            ms_size_temp = 2 ** ms_shift_temp;
            ms_count_temp = Math.floor(cd.vdev_asize / ms_size_temp);
            if (ms_count_temp < 200 || ms_shift_temp == 34) {
              cd.metaslab_shift = ms_shift_temp;
              break;
            }
          }

          cd.ms_count_max = 2 ** 17;
          cd.highbit = Math.ceil(Math.log2(Math.floor(cd.vdev_asize / cd.ms_count_max)));
          if (cd.highbit > cd.metaslab_shift) {
            cd.metaslab_shift = cd.highbit;
          }

          if (cd.raid_type == "m" || cd.raid_type == "z") {
            cd.metaslab_size = 2 ** cd.metaslab_shift;
            cd.ms_count = Math.floor(cd.vdev_asize / cd.metaslab_size);

            if (cd.ms_count < 16) {
              cd.ms_count = 16;
              cd.metaslab_size = Math.floor(cd.vdev_asize / 16);
            }

            cd.vdev_raw_size = cd.metaslab_size * cd.ms_count;
          } else {
            cd.metaslab_base_size = 2 ** cd.metaslab_shift;
            cd.group_alloc_size = cd.group_width * 2 ** ashift;

            if (fast_draid) {
              cd.metaslab_size = Math.floor(cd.metaslab_base_size / cd.group_alloc_size) * cd.group_alloc_size;
              cd.ms_count = Math.floor(cd.vdev_asize / cd.metaslab_size);
              cd.vdev_raw_size = cd.metaslab_size * cd.ms_count;
            } else {
              cd.ms_count = 0;
              cd.vdev_raw_size = 0;

              ms_start = swap_size * 1024 ** 3;
              var asize_remaining = cd.vdev_asize - (swap_size * 1024 ** 3);

              while (asize_remaining >= cd.metaslab_base_size) {
                astart = Math.ceil(ms_start / cd.group_alloc_size) * cd.group_alloc_size;
                alignment_loss = astart - ms_start;
                asize = Math.floor((cd.metaslab_base_size - alignment_loss) / cd.group_alloc_size) * cd.group_alloc_size;
                cd.ms_count += 1;
                cd.vdev_raw_size += asize;
                ms_start += cd.metaslab_base_size;
                asize_remaining -= cd.metaslab_base_size;
              }
            }
          }

          cd.zfs_pool_size = cd.vdev_raw_size * cd.vdev_count;

          cd.sector_size = 2 ** ashift;
          cd.recordsize_bytes = recordsize * 1024;

          if (cd.raid_type == "m") {
            cd.vdev_deflate_ratio = 1;
          }

          if (cd.raid_type == "z") {
            cd.min_sector_count = cd.parity_level + 1;
            cd.num_data_sectors = cd.recordsize_bytes / cd.sector_size;
            cd.data_stripes = cd.num_data_sectors / (cd.vdev_width - cd.parity_level);
            cd.data_stripes_rounded = Math.ceil(cd.data_stripes);
            cd.num_parity_sectors = cd.data_stripes_rounded * cd.parity_level;
            cd.data_plus_parity_sectors = cd.num_data_sectors + cd.num_parity_sectors;
            cd.total_sector_count = Math.ceil(cd.data_plus_parity_sectors / cd.min_sector_count) * cd.min_sector_count;
            cd.reduction_ratio = cd.num_data_sectors / cd.total_sector_count;
            cd.vdev_deflate_ratio = Math.floor(cd.reduction_ratio * 512) / 512;
          }

          if (cd.raid_type == "d") {
            cd.num_data_sectors = cd.recordsize_bytes / cd.sector_size;
            cd.num_redundancy_groups = cd.num_data_sectors / cd.data_disks;
            cd.num_groups_rounded = Math.ceil(cd.num_redundancy_groups);
            cd.total_sector_count = cd.num_groups_rounded * (cd.data_disks + cd.parity_level);
            cd.reduction_ratio = cd.num_data_sectors / cd.total_sector_count;
            cd.vdev_deflate_ratio = Math.floor(cd.reduction_ratio * 512) / 512;
          }

          cd.vdev_usable_capacity = cd.vdev_raw_size * cd.vdev_deflate_ratio;
          cd.pool_usable_pre_slop = cd.vdev_usable_capacity * cd.vdev_count;

          cd.slop_max = 128 * 1024 ** 3;
          cd.slop_min = 128 * 1024 ** 2;
          cd.slop_computed = cd.pool_usable_pre_slop * 1 / 32;
          if (use_new_slop) {
            cd.slop_actual = Math.max(Math.min(cd.slop_computed, cd.slop_max), cd.slop_min);
          } else {
            cd.slop_actual = Math.max(cd.slop_computed, cd.slop_min);
          }

          cd.pool_usable_bytes = cd.pool_usable_pre_slop - cd.slop_actual;
          if (cd.pool_usable_bytes < 0) {
            cd.pool_usable_bytes = 0;
          }
          cd.pool_usable_gib = cd.pool_usable_bytes / 1024 ** 3;
          cd.pool_usable_tib = cd.pool_usable_bytes / 1024 ** 4;
          cd.pool_usable_pib = cd.pool_usable_bytes / 1024 ** 5;
          cd.pool_usable_eib = cd.pool_usable_bytes / 1024 ** 6;

          cd.pool_usable_gb = cd.pool_usable_bytes / 1000 ** 3;
          cd.pool_usable_tb = cd.pool_usable_bytes / 1000 ** 4;
          cd.pool_usable_pb = cd.pool_usable_bytes / 1000 ** 5;
          cd.pool_usable_eb = cd.pool_usable_bytes / 1000 ** 6;

          cd.storage_efficiency = cd.pool_usable_bytes / cd.pool_raw_capacity * 100;

          if (cd.raid_type == "m") {
            cd.simple_capacity = cd.vdev_count * cd.disk_size * tb_to_tib;
          }
          if (cd.raid_type == "z") {
            cd.simple_capacity = (cd.vdev_width - cd.parity_level) * cd.vdev_count * cd.disk_size * tb_to_tib;
          }
          if (cd.raid_type == "d") {
            cd.simple_capacity = (cd.vdev_width - cd.spare_disks) / (cd.data_disks + cd.parity_level) * cd.data_disks * cd.vdev_count * cd.disk_size * tb_to_tib;
          }

          cd.zfs_overhead = (1 - (cd.pool_usable_tib / cd.simple_capacity)) * 100;

          return cd;
        }

        function update() {
          get_form_data();
          var raid_layouts = [mirror, z1, z2, z3, draid];

          if (show_afr) {
            $("label#disk_afr_label").css("color", "black");
            $("input#disk_afr").prop("disabled", false);
            $("label#allow_resilver_label").css("color", "black");
            $("input#allow_resilver").prop("disabled", false);

            if (allow_resilver) {
              $("label#resilver_time_label").css("color", "black");
              $("input#resilver_time").prop("disabled", false);
            } else {
              $("label#resilver_time_label").css("color", "grey");
              $("input#resilver_time").prop("disabled", true);
            }
          } else {
            $("label#disk_afr_label").css("color", "grey");
            $("input#disk_afr").prop("disabled", true);
            $("label#allow_resilver_label").css("color", "grey");
            $("input#allow_resilver").prop("disabled", true);
            $("label#resilver_time_label").css("color", "grey");
            $("input#resilver_time").prop("disabled", true);
          }

          if (table_data == "cap_w_reserve") {
            $("label#reservation").css("color", "black");
            $("input#reservation").prop("disabled", false);
          } else {
            $("label#reservation").css("color", "grey");
            $("input#reservation").prop("disabled", true);
          }
          for (var p = 0; p < raid_layouts.length; p++) {
            for (var v = 0; v < raid_layouts[p].length; v++) {
              var capacity_data;
              var vdev_width = raid_layouts[p][v];

              for (var d = 0; d < disk_sizes.length; d++) {
                if (Number.isInteger(disk_sizes[d]) == true) {
                  disk_size_label = disk_sizes[d];
                } else {
                  disk_size_label = disk_sizes[d].toString().replace(".", "_");
                }

                if (p == 0) {
                  var vdev_layout = disk_size_label + "t" + vdev_width + "wm";
                } else if (p == 4) {
                  var vdev_layout = disk_size_label + "t" + vdev_width;
                } else {
                  var vdev_layout = disk_size_label + "t" + vdev_width + "wz" + p;
                }

                capacity_data = get_capacity(vdev_layout);

                if (p == 4) {
                  vdev_layout = vdev_layout.replaceAll(":", "-");
                }

                if (p == 0 && v == 0) {
                  capacity_tb = disks * disk_sizes[d];
                  if (capacity_tb > 1000) {
                    capacity_pb = capacity_tb / 1000;
                    $("td." + vdev_layout).text(rnd(capacity_pb, decimal_places) + " PB");
                  } else {
                    $("td." + vdev_layout).text(rnd(capacity_tb, decimal_places) + " TB");
                  }
                } else {
                  if (table_data == "usable_cap_tib") {
                    if (show_bytes) {
                      $("td." + vdev_layout).text(capacity_data.pool_usable_bytes);
                    } else {
                      if (capacity_data.pool_usable_gib < 1024) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_gib, decimal_places) + " GiB");
                      } else if (capacity_data.pool_usable_tib < 1024) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_tib, decimal_places) + " TiB");
                      } else if (capacity_data.pool_usable_pib < 1024) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_pib, decimal_places) + " PiB");
                      } else {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_tib, decimal_places) + " EiB");
                      }
                    }
                  } else if (table_data == "usable_cap_tb") {
                    if (show_bytes) {
                      $("td." + vdev_layout).text(capacity_data.pool_usable_bytes);
                    } else {
                      if (capacity_data.pool_usable_gb < 1000) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_gb, decimal_places) + " GB");
                      } else if (capacity_data.pool_usable_tb < 1000) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_tb, decimal_places) + " TB");
                      } else if (capacity_data.pool_usable_pb < 1000) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_pb, decimal_places) + " PB");
                      } else {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_tb, decimal_places) + " EB");
                      }
                    }
                  } else if (table_data == "efficiency") {
                    $("td." + vdev_layout).text(rnd(capacity_data.storage_efficiency, decimal_places) + "%");
                  } else if (table_data == "overhead") {
                    $("td." + vdev_layout).text(rnd(capacity_data.zfs_overhead, decimal_places) + "%");
                  } else if (table_data == "cap_w_reserve") {
                    if (show_bytes) {
                      $("td." + vdev_layout).text(capacity_data.pool_usable_bytes * (1 - reservation));
                    } else {
                      if (capacity_data.pool_usable_tib * (1 - reservation) > 1024) {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_pib * (1 - reservation), decimal_places) + " PiB");
                      } else {
                        $("td." + vdev_layout).text(rnd(capacity_data.pool_usable_tib * (1 - reservation), decimal_places) + " TiB");
                      }
                    }
                  }
                }
              }

              if (p == 0) {
                if (v == 0) {
                  $("td.vdev" + vdev_width + "wm").text(disks + " disks");
                } else {
                  $("td.vdev" + vdev_width + "wm").text(capacity_data.vdev_count + " vdev + " + capacity_data.spares_count + " spare");
                }
              } else {
                if (capacity_data.raid_type == "d") {
                  var draid_label = vdev_width.replaceAll(":", "-");
                  $("td.vdev" + draid_label).text(capacity_data.vdev_count + " vdev + " + capacity_data.spares_count + " spare");
                } else {
                  $("td.vdev" + vdev_width + "wz" + p).text(capacity_data.vdev_count + " vdev + " + capacity_data.spares_count + " spare");
                }
              }

              var redundancy;

              if (p == 0) {
                redundancy = vdev_width - 1;
              } else if (p == 4) {
                redundancy = parseInt(vdev_width.split(":")[0].replace("draid", ""));
              } else {
                redundancy = p;
              }

              if (p == 4) {
                draid_width = parseInt(vdev_width.split(":")[2].replace("c", ""));
                if (allow_resilver && redundancy != 0) {
                  var disk_hourly_failure_rate = disk_afr / 8760;
                  var disk_failure_probability = disk_hourly_failure_rate * resilver_time;
                  var pool_afr = R2C2(draid_width, redundancy, capacity_data.vdev_count, disk_failure_probability) * 100;
                } else {
                  var pool_afr = R2C2(draid_width, redundancy, capacity_data.vdev_count, disk_afr) * 100;
                }
                $("td.vdev" + vdev_width.replaceAll(":", "-") + "afr").text(rnd(pool_afr, decimal_places) + "%");
              } else {
                if (allow_resilver && redundancy != 0) {
                  var disk_hourly_failure_rate = disk_afr / 8760;
                  var disk_failure_probability = disk_hourly_failure_rate * resilver_time;
                  var pool_afr = R2C2(vdev_width, redundancy, capacity_data.vdev_count, disk_failure_probability) * 100;
                } else {
                  var pool_afr = R2C2(vdev_width, redundancy, capacity_data.vdev_count, disk_afr) * 100;
                }

                if (p == 0) {
                  if (v == 0) {
                    $("td.vdev" + vdev_width + "wmafr").text(" - ");
                  } else {
                    $("td.vdev" + vdev_width + "wmafr").text(rnd(pool_afr, decimal_places) + "%");
                  }
                } else {
                  $("td.vdev" + vdev_width + "wz" + p + "afr").text(rnd(pool_afr, decimal_places) + "%");
                }
              }

              deflate_ratio = rnd(capacity_data.vdev_deflate_ratio * 100, decimal_places);

              if (p == 0) {
                if (v == 0) {
                  $("td.vdev" + vdev_width + "wmdeflate").text(" - ");
                } else {
                  $("td.vdev" + vdev_width + "wmdeflate").text(deflate_ratio + "%");
                }
              } else if (p == 4) {
                $("td.vdev" + vdev_width.replaceAll(":", "-") + "deflate").text(deflate_ratio + "%");
              } else {
                $("td.vdev" + vdev_width + "wz" + p + "deflate").text(deflate_ratio + "%");
              }
            }
          }
        }

        function update_shelf_count() {
          var es24 = [calculate_shelf_count(12, 24), calculate_shelf_count(24, 24), calculate_shelf_count(48, 24)];
          var es60 = [calculate_shelf_count(12, 60), calculate_shelf_count(24, 60), calculate_shelf_count(48, 60)];
          var es102 = [calculate_shelf_count(12, 102), calculate_shelf_count(24, 102), calculate_shelf_count(48, 102)];

          var status_html = "<table class=\"shelf_count\"><tr><td><i>Shelf Count</i></td><td>12-Bay Head</td><td>24-Bay Head</td><td>48-Bay Head</td></tr>";
          status_html += "<tr><td>24-Bay Shelf</td><td>" + es24[0] + "</td><td>" + es24[1] + "</td><td>" + es24[2] + "</td></tr>";
          status_html += "<tr><td>60-Bay Shelf</td><td>" + es60[0] + "</td><td>" + es60[1] + "</td><td>" + es60[2] + "</td></tr>";
          status_html += "<tr><td>102-Bay Shelf</td><td>" + es102[0] + "</td><td>" + es102[1] + "</td><td>" + es102[2] + "</td></tr>";

          $("td#status").html(status_html);
        }

        function calculate_shelf_count(head_size, shelf_size) {
          var disks_unaccounted_for = disks;
          disks_unaccounted_for -= head_size;
          if (disks_unaccounted_for <= 0) {
            free_bays = head_size - disks;
            return "0 (" + String(free_bays) + " free)";
          }
          var shelf_count = Math.ceil(disks_unaccounted_for / shelf_size);
          var free_bays = (head_size + shelf_count * shelf_size) - disks;
          return String(shelf_count) + " (" + String(free_bays) + " free)";
        }

        function update_debug(vdev_layout) {
          if (vdev_layout == undefined) {
            vdev_layout = "";
          }
          if (vdev_layout == "white") {
            vdev_layout = "";
          }

          if (vdev_layout.includes("draid")) {
            vdev_layout = vdev_layout.replaceAll("-", ":");
          }

          var debug_text;

          if (!vdev_layout.includes("vdev") && vdev_layout != "") {
            var cd = get_capacity(vdev_layout);

            if (cd.raid_type == "m") {
              if (cd.vdev_width == 1) {
                debug_text = "<tr><td colspan=\"2\"><b>Stripe (" + cd.disk_size + " TB disks)</b></td></tr>";
              } else {
                debug_text = "<tr><td colspan=\"2\"><b>" + cd.vdev_width + "-way Mirror (" + cd.disk_size + " TB disks)</b></td></tr>";
              }
            } else if (cd.raid_type == "z") {
              debug_text = "<tr><td colspan=\"2\"><b>" + cd.vdev_width + "-wide RAIDZ" + cd.parity_level + " (" + cd.disk_size + " TB disks)</b></td></tr>";
            } else if (cd.raid_type == "d") {
              var draid_label = "draid" + cd.parity_level + ":" + cd.data_disks + "d:" + cd.vdev_width + "c:" + cd.spare_disks + "s";
              debug_text = "<tr><td colspan=\"2\"><b>" + draid_label + " (" + cd.disk_size + " TB disks)</b></td></tr>";
            }

            if (cd.vdev_width == 1) {
              debug_text += "<tr><td colspan=\"2\"><b>" + disks + " disks</b></td></tr>";
            } else {
              debug_text += "<tr><td colspan=\"2\"><b>" + cd.vdev_count + " vdevs (" + disks + " disks, " + cd.spares_count + " spares)</b></td></tr>";
            }

            for (const [key, value] of Object.entries(cd)) {
              debug_text += "<tr><td>" + key + "</td><td>" + value + "</td></tr>";
            }

            $("table#debug_vals").html(debug_text);
          }
        }

        function Factorial(n) {
          var rval = 1;
          for (var i = 2; i <= n; i++) {
            rval = rval * i;
          }
          return rval;
        }

        function BinomCoeff(n, k) {
          return Factorial(n) / (Factorial(k) * Factorial(n - k));
        }

        function BinomDistrib(n, k, p) {
          return BinomCoeff(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }

        function R2C2(numHDD, rLvl, numVdev, pFail) {
          var P = 0;
          for (var i = rLvl; i >= 0; i--) {
            P = P + BinomDistrib(numHDD, i, pFail);
          }
          return 1 - Math.pow(P, numVdev);
        }

        function tableToTSV(table) {
          const rows = Array.from(table.querySelectorAll("tr"));
          return rows
            .map((row) =>
              Array.from(row.querySelectorAll("th, td"))
                .map((cell) => cell.textContent.trim())
                .join("\t")
            )
            .join("\n");
        }

        async function copyVisibleTables() {
          const status = document.getElementById("copy_status");
          const visibleTables = Array.from(document.querySelectorAll("div.results"))
            .filter((section) => section.offsetParent !== null)
            .map((section) => {
              const table = section.querySelector("table");
              const label = document.querySelector(`p.sect_labels#${section.id}`);
              return { label: label ? label.textContent.trim() : section.id, table };
            })
            .filter((entry) => entry.table);

          if (visibleTables.length === 0) {
            status.textContent = "No visible tables to copy.";
            return;
          }

          const payload = visibleTables
            .map((entry) => `${entry.label}\n${tableToTSV(entry.table)}`)
            .join("\n\n");

          try {
            await navigator.clipboard.writeText(payload);
            status.textContent = "Copied visible tables.";
          } catch (error) {
            status.textContent = "Copy failed. Please try again.";
          }
        }

        draw_tables();
        update();
        update_shelf_count();
        update_debug("18t7wz2");

        $("input.monitor").change(function() {
          update();
          update_shelf_count();
          update_debug("18t7wz2");
        });

        $("input#show_afr").change(function() {
          draw_tables();
          update();
        });

        $("input#show_deflate").change(function() {
          draw_tables();
          update();
        });

        $("select#show").change(function() {
          draw_tables();
          update();

          if (show == "all") {
            $("p.sect_labels").toggle(true);
            $("div.results").toggle(true);
          } else {
            $("p.sect_labels").toggle(false);
            $("div.results").toggle(false);

            $("p#" + show).toggle(true);
            $("div#" + show).toggle(true);
          }
        });

        $("select.monitor").change(function() {
          update();
          update_debug("18t7wz2");
          update_shelf_count();
        });

        $("select#add_vdev_type").change(function() {
          var raid_type = $("select#add_vdev_type").val();
          var tr_text;

          tr_text = "<td><label class=\"tooltip\" id=\"use_new_slop\">?</label><label for=\"use_new_slop\">OpenZFS 2.0.7 Slop:</label></td>";
          tr_text += "<td><input class=\"monitor\" type=\"checkbox\" id=\"use_new_slop\" name=\"use_new_slop\" checked></td>";

          if (raid_type == "draid") {
            tr_text += "<td id=\"draid_settings\" colspan=\"2\">";
            tr_text += "<label class=\"draid_settings\">draid</label>";
            tr_text += "<input type=\"text\"  class=\"draid_settings\" id=\"draid_parity\">";
            tr_text += "<label class=\"draid_settings\">:</label>";
            tr_text += "<input type=\"text\"  class=\"draid_settings\" id=\"draid_data\">";
            tr_text += "<label class=\"draid_settings\">d:</label>";
            tr_text += "<input type=\"text\"  class=\"draid_settings\" id=\"draid_children\">";
            tr_text += "<label class=\"draid_settings\">c:</label>";
            tr_text += "<input type=\"text\"  class=\"draid_settings\" id=\"draid_spares\">";
            tr_text += "<label class=\"draid_settings\">s</label>";
            tr_text += "</td>";
          } else {
            tr_text += "<td><label for=\"add_vdev\" id=\"add_vdev\">New Vdev Width:</label></td>";
            tr_text += "<td><input type=\"text\" id=\"add_vdev\" name=\"add_vdev\"></td>";
          }

          $("tr#new_vdev").empty();
          $("tr#new_vdev").html(tr_text);

          if (use_new_slop) {
            $("input#use_new_slop").prop("checked", true);
          } else {
            $("input#use_new_slop").prop("checked", false);
          }
        });

        function add_rem_disks(num_disks) {
          new_disk_qty = disks + num_disks;
          new_disk_qty = validate_input(new_disk_qty, "disks", disks, 0, 999999, true);

          if (new_disk_qty != disks) {
            $("input#disks").val(new_disk_qty);
            draw_tables();
            update();
            update_shelf_count();
          }
        }

        $("div.half.up").click(function() {
          var id = $(this).attr("id");
          id = parseInt(id.replace("plus_", ""));
          add_rem_disks(id);
        });

        $("div.half.down").click(function() {
          var id = $(this).attr("id");
          id = parseInt(id.replace("minus_", ""));
          add_rem_disks(-1 * id);
        });

        $(document).on("mouseover", "label.tooltip", function() {
          var id = $(this).attr("id");
          switch (id) {
            case "disks":
              update_shelf_count();
              break;
            case "min_spares":
              $("td#status").html("<b>Minimum Spares:</b> Set aside at least this many disks as hot spares for the pool.");
              break;
            case "use_new_slop":
              $("td#status").html("<b>OpenZFS 2.0.7 Slop:</b> ZFS reserves a bit of capacity to prevent major issues if the pool should fill up to 100%. This space is called slop space. As of OpenZFS 2.0.7, slop space is capped at a smaller size so you get more usable capacity.");
              break;
            case "recordsize":
              $("td#status").html("<b>ZFS recordsize value:</b> Using a different recordsize value on your datasets can help minimize capacity wasted due to padding and overhead. <b>Note:</b> The zfs list command always assumes a 128KiB recordsize for capacity calculations. The usable capacity values displayed below represent how much data you can store on a pool with a given recordsize, but changing your recordsize will not change the capacity that zfs list displays.");
              break;
            case "ashift":
              $("td#status").html("<b>ZFS ashift value:</b> ZFS uses ashift to track the smallest possible I/O it can perform (2^ashift = smallest possible I/O). Ideally, this maps to your disk's sector size. For 4KiB sectors, use ashift=12. For 512 byte sectors, use ashift=9.");
              break;
            case "swap_size":
              $("td#status").html("<b>Disk Swap Size:</b> If your pool disks have swap space on them, you can account for that here.");
              break;
            case "usable_cap_tib":
              $("td#status").html("<b>Usable Capacity (TiB):</b> Display usable capacity as powers of 1024 rather than powers of 1000. This is how computers will display usable capacity.");
              break;
            case "usable_cap_tb":
              $("td#status").html("<b>Usable Capacity (TB):</b> Display usable capacity as powers of 1000. This is how hard disk manufacturers label capacity but not how computers see it.");
              break;
            case "show_deflate":
              $("td#status").html("<b>Show Deflate Ratio:</b> The deflate ratio is the ratio of the amount of data stored to its size on disk with parity and padding, always rounded down to an even factor of 512. A higher deflate ratio results in higher usable capacity for a given set of disks. Displayed below as a percentage value for readability.");
              break;
            case "efficiency":
              $("td#status").html("<b>Capacity Efficiency:</b> Usable capacity of the pool divided by the raw capacity of all of the disks in the pool times 100%.");
              break;
            case "show_afr":
              $("td#status").html("<b>Show Pool AFR:</b> Calculates a very rough annual failure rate (AFR) for each vdev layout assuming the AFR of an individual disk.");
              break;
            case "overhead":
              $("td#status").html("<b>ZFS Overhead:</b> Calculates simple capacity as the number of data disks times each disk's capacity then shows the difference between the simple capacity and actual usable capacity (which will always be lower) as a percent difference.");
              break;
            case "cap_w_reserve":
              $("td#status").html("<b>Cap. w/ Reservation:</b> ZFS best practices usually recommend filling a pool to no more than 80% of its total capacity. Selecting this option lets you factor in that 20% reserved space and show how much capacity you can actually use while keeping to best practices.");
              break;
            case "fast_draid":
              $("td#status").html("<b>Fast dRAID Calculation:</b> Enables an approximate (but much faster) capacity calculation for dRAID layouts. The fast/approximate calculations are high by up to 0.001%.");
              break;
            case "show":
              $("td#status").html("<b>Show Only:</b> Hides all output except for the table corresponding to the selected RAID type and the debug output.");
              break;
          }
        });

        $("button#add_disk").click(function() {
          var new_disk = parseFloat($("input#add_disk").val());

          if (isNaN(new_disk)) {
            $("input#add_disk").val("");
            $("td#status").html("Invalid disk size");
            return;
          }

          if (new_disk <= 0 && add_disk_unit == "TB") {
            $("input#add_disk").val("");
            $("td#status").html("Invalid disk size");
            return;
          }

          if (new_disk < 1 && add_disk_unit == "GB") {
            $("input#add_disk").val("");
            $("td#status").html("Invalid disk size");
            return;
          }

          new_disk = rnd(new_disk, 3);

          if (new_disk > 10000 && add_disk_unit == "TB") {
            new_disk = 10000;
            $("input#add_disk").val("10000");
          }

          if (new_disk > 10000000 && add_disk_unit == "GB") {
            new_disk = 10000000;
            $("input#add_disk").val("10000000");
          }

          if (add_disk_unit == "GB") {
            new_disk = new_disk / 1000;
          }

          if (disk_sizes.includes(new_disk)) {
            $("input#add_disk").val("");
            if (add_disk_unit == "TB") {
              $("td#status").html(new_disk + "TB disk already added");
            } else {
              $("td#status").html(new_disk * 1000 + "GB disk already added");
            }
            return;
          }

          $("input#add_disk").val("");

          if (add_disk_unit == "TB") {
            $("td#status").html(new_disk + "TB disk added");
          } else {
            if (new_disk * 1000 <= swap_size) {
              $("td#status").html(new_disk * 1000 + "GB disk added (check swap size)");
            } else {
              $("td#status").html(new_disk * 1000 + "GB disk added");
            }
          }

          if (custom_sizes.length == 0) {
            lowest_custom_size = new_disk;
          }
          custom_sizes.unshift(new_disk);

          disk_sizes = hdd_sizes.concat(ssd_sizes);
          disk_sizes = custom_sizes.concat(disk_sizes);

          draw_tables();
          update();
        });

        $("button#tb_gb").click(function() {
          if (add_disk_unit == "TB") {
            add_disk_unit = "GB";
          } else {
            add_disk_unit = "TB";
          }
          $("label#add_disk").html("Add Disk (" + add_disk_unit + "):");
        });

        $("button#add_vdev").click(function() {
          var new_vdev_type = $("select#add_vdev_type").val();

          if (new_vdev_type == "draid") {
            var draid_parity = parseInt($("input#draid_parity").val());
            var draid_data = parseInt($("input#draid_data").val());
            var draid_children = parseInt($("input#draid_children").val());
            var draid_spares = parseInt($("input#draid_spares").val());

            if (isNaN(draid_parity) || isNaN(draid_data) || isNaN(draid_children) || isNaN(draid_spares)) {
              $("td#status").html("Invalid vdev layout");
              return;
            }

            if (draid_parity <= 0 || draid_data <= 0 || draid_children <= 0 || draid_spares < 0) {
              $("td#status").html("Invalid vdev layout");
              return;
            }

            if (draid_parity > 3) {
              $("td#status").html("dRAID parity must be between 1 and 3");
              return;
            }

            if (draid_parity + draid_data + draid_spares > draid_children) {
              $("td#status").html("dRAID parity + data + spares must be greater than children");
              return;
            }

            var new_draid_layout = "draid" + draid_parity + ":" + draid_data + "d:" + draid_children + "c:" + draid_spares + "s";

            if (draid.includes(new_draid_layout)) {
              $("td#status").html(new_draid_layout + " already added");
              $("input#draid_parity").val("");
              $("input#draid_data").val("");
              $("input#draid_children").val("");
              $("input#draid_spares").val("");
              return;
            }

            draid.push(new_draid_layout);
            $("td#status").html(new_draid_layout + " added");
          } else {
            var new_vdev_width = parseInt($("input#add_vdev").val());

            if (isNaN(new_vdev_width) || new_vdev_width <= 0) {
              $("input#add_vdev").val("");
              $("td#status").html("Invalid vdev layout");
              return;
            }

            if (new_vdev_type == "z1" && new_vdev_width < 2) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-wide Z1 invalid");
              return;
            }

            if (new_vdev_type == "z2" && new_vdev_width < 3) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-wide Z2 invalid");
              return;
            }

            if (new_vdev_type == "z3" && new_vdev_width < 4) {
              $("td#status").html(new_vdev_width + "-wide Z3 invalid");
              $("input#add_vdev").val("");
              return;
            }

            if (new_vdev_type == "mirror" && mirror.includes(new_vdev_width)) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-way mirror already added");
              return;
            }

            if (new_vdev_type == "z1" && z1.includes(new_vdev_width)) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-wide Z1 already added");
              return;
            }

            if (new_vdev_type == "z2" && z2.includes(new_vdev_width)) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-wide Z2 already added");
              return;
            }

            if (new_vdev_type == "z3" && z3.includes(new_vdev_width)) {
              $("input#add_vdev").val("");
              $("td#status").html(new_vdev_width + "-wide Z3 already added");
              return;
            }

            if (new_vdev_width > 1000) {
              new_vdev_width = 1000;
              $("input#add_vdev").val("1000");
            }

            if (new_vdev_type == "mirror") {
              mirror.push(new_vdev_width);
              mirror = mirror.sort(function(a, b) {
                return a - b;
              });
            }

            if (new_vdev_type == "z1") {
              z1.push(new_vdev_width);
              z1 = z1.sort(function(a, b) {
                return a - b;
              });
            }

            if (new_vdev_type == "z2") {
              z2.push(new_vdev_width);
              z2 = z2.sort(function(a, b) {
                return a - b;
              });
            }

            if (new_vdev_type == "z3") {
              z3.push(new_vdev_width);
              z3 = z3.sort(function(a, b) {
                return a - b;
              });
            }

            $("input#add_vdev").val("");

            if (new_vdev_type == "mirror") {
              $("td#status").html(new_vdev_width + "-way mirror added");
            } else {
              $("td#status").html(new_vdev_width + "-wide " + new_vdev_type.toUpperCase() + " added");
            }
          }

          raid_layouts = ["common", mirror, z1, z2, z3, draid];
          draw_tables();
          update();
        });

        $("button#reset_button").click(function() {
          hdd_sizes = [4, 8, 12, 14, 18, 22, 24, 26];
          ssd_sizes = [1.92, 3.84, 7.68, 15.36, 30.72, 61.44, 122.88];
          custom_sizes = [];
          disk_sizes = hdd_sizes.concat(ssd_sizes);
          first_ssd = 1.92;
          mirror = [0, 1, 2, 3];
          z1 = [3, 4, 5, 6, 7, 8, 9, 10];
          z2 = [5, 6, 7, 8, 9, 10, 11, 12];
          z3 = [7, 8, 9, 10, 11, 12, 13, 14];
          draid = [
            "draid1:4d:24c:0s",
            "draid1:8d:24c:0s",
            "draid2:8d:24c:0s",
            "draid2:16d:24c:0s",
            "draid3:8d:24c:0s",
            "draid3:16d:24c:0s"
          ];

          raid_layouts = ["common", mirror, z1, z2, z3, draid];
          draw_tables();
          update();

          $("td#status").html("Custom disks and layouts cleared.");
        });

        $(document).on("click", "td", function() {
          if (update_with_mouseover == false) {
            update_with_mouseover = true;
            $("td").css("background-color", "");
          } else {
            cell = $(this).attr("class");
            if (cell == undefined) {
              cell = "";
            }
            if (cell == "white") {
              cell = "";
            }
            if (!cell.includes("vdev") && cell != "") {
              update_with_mouseover = false;

              $(this).css("background-color", "#e83a3a");
            }
          }
        });

        $(document).on("mouseover", "td", function() {
          if (update_with_mouseover) {
            update_debug($(this).attr("class"));
          }
        });

        $("#copy_table").on("click", copyVisibleTables);
      });
    </script>
  </body>
</html>
